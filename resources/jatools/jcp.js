var am="www.jatools.com";function k(as){var at=this;var V=JSON.parse||function(str){if(str==="")str='""';eval("var p="+str+";");return p;};function ajax(url,data,aa){try{if(data&&typeof(data)==='object'){data.tab=ai||"";data=JSONstringify(data);}var x=new(window.XDomainRequest||window.XMLHttpRequest||ActiveXObject)('MSXML2.XMLHTTP.3.0');x.open(data?'POST':'GET',url,1);if(window.XDomainRequest){x.onload=function(){var data=V(x.responseText||"{}");aa&&aa(data,x.responseText,200);}}else{x.onreadystatechange=function(){try{var data=V(x.responseText||"{}");x.readyState>3&&aa&&aa(data,x.responseText,x.status);}catch(e){window.console&&console.log(e);}};}x.send(data)}catch(e){window.console&&console.log(e);}};function l(ad,id){return ad.getElementById(id);};function m(d){var b="";var e=d.styleSheets;for(var g=0;g<e.length;g++){var h=e[g];try{var c=h.cssRules;if(c){for(var a=0;a<c.length;a++){b+=c[a].cssText||""}}else{if(h.cssText){b+=h.cssText}}}catch(f){}}return b+""};function D(ad,node){if(ad.doctype)node.setAttribute('_strict','true');return node.outerHTML||(function(n){var div=ad.createElement('div'),h;div.appendChild(n.cloneNode(true));h=div.innerHTML;div=null;return h;})(node);};var aw;function X(ad,myDoc){if(typeof(ad.getElementById)!='undefined'){var html='';var result={style:m(ad)};if(myDoc.pages){for(var i=0;i<myDoc.pages.length;i++){var page=myDoc.pages[i];if(typeof(page.substring)!='undefined'){page=l(ad,page);}html+=("<div id='page"+(i+1)+"'>"+D(ad,page)+"</div>");}}else{if(myDoc.jobPages){if(!myDoc.jobBase){myDoc.jobBase=0;aw=myDoc.done||null;var i=0;while(true){var page=l(ad,(myDoc.pagePrefix||'')+'page'+(i+1));if(!page)break;i++;}myDoc.ax=i;}for(var i=0;i<myDoc.jobPages;i++){var page=l(ad,(myDoc.pagePrefix||'')+'page'+(i+myDoc.jobBase+1));if(!page)break;html+=D(ad,page);}if(myDoc.done){myDoc.done=function(){var page=l(ad,(myDoc.pagePrefix||'')+'page'+(i+myDoc.jobBase+1));if(!page&&aw){aw();}else{myDoc.jobBase=myDoc.jobBase+myDoc.jobPages;myDoc.documents=document;at.print(myDoc,false);}}}}else{var i=0;while(true){var page=l(ad,(myDoc.pagePrefix||'')+'page'+(i+1));if(!page)break;html+=D(ad,page);i++;}}}result.pages=html;return result;}else return ad;};function C(myDoc){myDoc.documents=w(myDoc);if(myDoc.footer&&myDoc.footer.html.innerHTML){G(myDoc.footer.html);myDoc.footer.html=myDoc.footer.html.innerHTML;}if(myDoc.header&&myDoc.header.html.innerHTML){G(myDoc.header.html);myDoc.header.html=myDoc.header.html.innerHTML;}return myDoc;};function B(myDoc,aa){var ae=myDoc.documents;var needs=0;var wrapper=document.getElementById("_jp_wrapper");if(!wrapper){wrapper=document.createElement("div");wrapper.style.position='absolute';wrapper.style.left='-3000px';wrapper.style.width='2500px';wrapper.id='_jp_wrapper';document.body.appendChild(wrapper);}else wrapper.innerHTML='';var loaded=function(){if(true||(event.srcElement.readyState||'')=="complete"){ae[event.srcElement.ownerIndex]=event.srcElement.contentWindow.document;needs--;if(needs==0){aa();}}};if(typeof(ae.push)!='undefined'){for(var i=0;i<ae.length;i++){if(ae[i].substring){needs++;var frame=document.createElement("iframe");frame.ownerIndex=i;if(frame.attachEvent){frame.attachEvent("onload",loaded);}else{frame.onload=loaded;}frame.src=ae[i];wrapper.appendChild(frame);}}}else{aa();}};function G(target){var properties=['border','border-radius','box-shadow','height','margin','padding','width2','max-width','min-width','border-collapse','border-spacing','caption-side','empty-cells','table-layout','direction','font','font-family','font-style','font-variant','font-size','font-weight','letter-spacing','line-height','text-align','text-decoration','text-indent','text-overflow','text-shadow','text-transform','white-space','word-spacing','word-wrap','vertical-align','color','background','background-color','background-image','background-position','background-repeat','Opacity','bottom','clear','clip','cursor','display','float','left','opacity','outline ','overflow','position','resize ','right','top','visibility','z-index','list-style-image','list-style-position','list-style-type'];var elements=target.getElementsByTagName('*');for(var e=0;e<elements.length;e++){var el=elements.item(e);if(el.tagName=='IMG'){el.src=el.src;}var thisProps=(el.getAttribute("style")||'').split(";");for(var p=0;p<properties.length;p++){var thisProp=properties[p];var thisValue=null;if(el.currentStyle){thisValue=el.currentStyle[thisProp];}else if(window.getComputedStyle){if(window.getComputedStyle.getPropertyValue){thisValue=window.getComputedStyle(el,null).getPropertyValue(thisProp)}else{thisValue=window.getComputedStyle(el)[thisProp]};}if(thisValue){el.style[thisProp]=thisValue;}}}};function w(myDoc){var ae=myDoc.documents,result=null;if(typeof(ae.push)!='undefined'){result=[];for(var i=0;i<ae.length;i++){result.push(X(ae[i],myDoc));}return result;}else{return X(ae,myDoc);}};function I(target){var result="<html><head><style>"+m(target.ownerDocument)+"</style></head><body>"+D(target.ownerDocument,target)+'</body></html>';return result;};function A(ad){var result="<html><head><base href='"+ad.URL+"'/><style>"+m(ad)+"</style></head><body>"+ad.body.innerHTML+'</body></html>';return result;};function F(){var oj=document.getElementById("ojatoolsPrinter");if(oj){return oj.getAttribute("license")||"";}return "";};var lut=[];for(var i=0;i<256;i++){lut[i]=(i<16?'0':'')+(i).toString(16);}function K(){var d0=Math.random()*0xffffffff|0;var d1=Math.random()*0xffffffff|0;var d2=Math.random()*0xffffffff|0;var d3=Math.random()*0xffffffff|0;return lut[d0&0xff]+lut[d0>>8&0xff]+lut[d0>>16&0xff]+lut[d0>>24&0xff]+'-'+lut[d1&0xff]+lut[d1>>8&0xff]+'-'+lut[d1>>16&0x0f|0x40]+lut[d1>>24&0xff]+'-'+lut[d2&0x3f|0x80]+lut[d2>>8&0xff]+'-'+lut[d2>>16&0xff]+lut[d2>>24&0xff]+lut[d3&0xff]+lut[d3>>8&0xff]+lut[d3>>16&0xff]+lut[d3>>24&0xff];};function empty(json){for(p in json){return false;}return true;};function Q(myDoc){var ah=["done","onState","listener","onPagePrinted"];for(var i=0;i<ah.length;i++){var e=ah[i];if(myDoc[e]){myDoc[e]=P(myDoc[e],false,i>0);myDoc._hasCallback=true;}}if(myDoc.dragDesigner&&myDoc.dragDesigner.ok){myDoc.dragDesigner.ok=P(myDoc.dragDesigner.ok);myDoc._hasCallback=true;}};var ac;var private_url;var aj=[];aj[3]="http://"+as+":31227/api?type=service&";var ab={};var ag=0;var ai;var av;function al(){setTimeout(function(){ajax(aj[1]+'type=TICK&',{},function(data,text,status){if(status!=200||data["api-error"]){on=false;return;}al();});},30000);};function O(){av=true;ajax(aj[1]+'type=PULL&',{},function(data,text,status){if(status!=200||data["api-error"]){on=false;return;}try{if(data.event){ab[data.event].apply(null,data.params||[data.data]);if(data.event.indexOf("fixed")!=0){delete ab[data.event];}}}catch(e){}if(empty(ab)){av=false;}else{O();}});};var on=false;var ar=[];function M(aa){ar.push(aa);if(ar.length==1){ajax("http://"+as+":31227/api?type=NEW&",{method:"new",lic:typeof(LIC)!='undefined'?LIC.key:"",base:document.URL},function(data,r,status){if(status!=200){ar.length=0;var error=' 杰表云打印（JCP）未安装或未开启.';if(!au.silent)alert(error);throw error;}else if(data["api-result"]){on=true;ai=data["api-result"];aj[0]="http://"+as+":31227/api?tab="+ai+"&use=common"+"&";aj[1]="http://"+as+":31227/api?tab="+ai+"&";aj[2]="http://"+as+":31227/api?type=UPDATE&";aj[3]="http://"+as+":31227/api?type=service&";al();O();while(ar.length){ar.shift()();}}else{ar.length=0;alert(data["api-error"]);throw data["api-error"];}});}};function P(aa,json,fixed){if(aa){var index=fixed?"fixed":"event-"+ag++;ab[index]=!json?aa:function(result){result=eval("("+result+")");aa(result);};return ai+":"+index;}else return "";};function H(aa){if(!on){M(aa);}else{aa();}};function ak(data,text,status){if(status!=200||data["api-error"]){if(status==200&&data["api-error"]=='NO_LICENSED_HOST'){alert("未经授权的主机："+data["host"]);ab={};}on=false;return;}};function R(target,param,data){(!av)&&O();ajax(aj[target]+(param||''),data,ak);};var new_=true;var au={};var self=null;return((self={updateService:"http://"+as+":31227/api?","initialize":function(){return this;},"options":function(o){if(o){au=o;return this;}else{return au;}},"getVersion":function(aa){H(function(){R(0,null,{method:"getVersion",event:P(aa)});})},"getDefaultPrinter":function(aa){H(function(){R(0,null,{method:"getDefaultPrinter",event:P(aa)});})},"getPrinterCapability":function(printer,ap,aa){var ao=function(result){result=eval("("+result+")");aa(result.result);};H(function(){R(0,null,{method:"getPrinterCapability",params:[printer,ap],event:P(ao)});})},"about":function(){H(function(){R(1,null,{method:"about"});})},"printPreview":function(myDoc,prompt){H(function(){myDoc=C(myDoc);Q(myDoc);R(1,null,{method:"printPreview",params:[myDoc,prompt?true:false]});})},"exit":function(){H(function(){R(1,null,{method:"exit"});})},"print":function(myDoc,prompt){H(function(){myDoc=C(myDoc);Q(myDoc);R(1,null,{method:"print",params:[myDoc,prompt?true:false]});})},"isInstalled":function(aa){ajax(this.updateService,{method:"getVersion"},function(data){aa(data.data);});},"configUpdateService":function(url,timer,aa){ajax(this.updateService,{method:"aq","version-check-url":url,"version-check-timer":timer},function(data){aa(data.data);});},"emptyCallback":function(){},"getPrinters":function(aa){H(function(){R(0,null,{method:"getPrinters",event:P(aa)});})},"getPrinterJobs":function(printer,aa){H(function(){R(0,null,{method:"getPrinterJobs",params:[printer],event:P(aa)});})},"getPapers":function(printer,aa){H(function(){R(0,null,{method:"getPapers",params:[printer],event:P(aa)});})},"isCustomPaperSupported":function(printer,aa){H(function(){R(0,null,{method:"isCustomPaperSupported",params:[printer],event:P(aa)});})},"addPaper":function(printer,name,width,height,aa){H(function(){R(0,null,{method:"addPaper",params:[printer,name,width,height],event:P(aa)});})},"isExcelInstalled":function(aa){H(function(){R(0,null,{method:"isExcelInstalled",event:P(aa)});})},"isImplemented":function(method,aa){H(function(){R(0,null,{method:"isImplemented",params:[method],event:P(aa)});})},"getLocalMacAddress":function(aa){H(function(){R(0,null,{method:"getLocalMacAddress",event:P(aa)});})},"getCPUSerialNo":function(aa){H(function(){R(0,null,{method:"getCPUSerialNo",event:P(aa)});})},"setOffsetPage":function(offset,aa){H(function(){R(0,null,{method:"setOffsetPage",params:[offset],event:P(aa)});})},"isPrintableFileType":function(filetype,aa){H(function(){R(0,null,{method:"isPrintableFileType",params:[filetype],event:P(aa)});})},"setDragCSS":function(settingid,styles,aa){H(function(){R(0,null,{method:"setDragCSS",params:[settingid,styles],event:P(aa)});})},"clearSettings":function(settingid,aa){H(function(){R(0,null,{method:"clearSettings",params:[settingid],event:P(aa)});})},"getSettingsIds":function(aa){H(function(){R(0,null,{method:"getSettingsIds",event:P(aa,true)});})},"printTIFF":function(url,margins,how,aa){H(function(){R(1,null,{method:"printTIFF",params:[url,margins,how],event:P(aa)});})},"printDocument":function(file,sets,aa){H(function(){Q(sets);R(1,null,{method:"printDocument",params:[file,sets],event:P(aa)});})},"exportAsExcel":function(tableEl,path,showProgress,aa){H(function(){var html=I(tableEl);R(1,null,{method:"exportAsExcel",params:[html,path,showProgress],event:P(aa)});})},"setupNormalOffset":function(settingid,aa){H(function(){R(1,null,{method:"setupNormalOffset",params:[settingid],event:P(aa)});})},"download":function(url,file,aa){H(function(){R(0,null,{method:"download",params:[url,file],event:P(aa)});})},"printToImage":function(myDoc,path,aa){H(function(){myDoc=C(myDoc);Q(myDoc);R(1,null,{method:"printToImage",params:[myDoc,path],event:P(aa)});})},"exportAsImage":function(myDoc,type,aa){if(as==am){H(function(){myDoc=C(myDoc);R(1,null,{method:"exportAsImage",params:[myDoc,type],event:P(function(file){var url="http://"+as+":31227/api?type=download&file="+file;aa(url);})});});}else getJCP(am).exportAsImage(myDoc,type,aa);},"exportAsPDF":function(myDoc,aa){if(as==am){H(function(){myDoc=C(myDoc);R(1,null,{method:"exportAsPDF",params:[myDoc],event:P(function(file){var url="http://"+as+":31227/api?type=download&file="+file;aa(url);})});});}else getJCP(am).exportAsPDF(myDoc,aa);},"exportAsTIFF":function(myDoc,aa){if(as==am){H(function(){myDoc=C(myDoc);R(1,null,{method:"exportAsTIFF",params:[myDoc],event:P(function(file){var url="http://"+as+":31227/api?type=download&file="+file;aa(url);})});});}else getJCP(am).exportAsTIFF(myDoc,aa);},"configUpdate":function(aq,ay,aa){H(function(){R(2,null,{method:"configUpdate",params:[aq,ay],event:P(aa)});})},"getFonts":function(aa){H(function(){R(0,null,{method:"getFonts",event:P(aa)});})},"copy":function(data,format,aa){H(function(){R(0,null,{method:"copy",params:[data,format],event:P(aa)});})},"copied":function(format,aa){H(function(){R(0,null,{method:"copied",params:[format],event:P(aa)});})},"writeString":function(file,af,data,aa){H(function(){R(0,null,{method:"writeString",params:[file,af,data],event:P(aa)});})},"writeBase64":function(file,data,aa){H(function(){R(0,null,{method:"writeBase64",params:[file,data],event:P(aa)});})},"readString":function(file,af,aa){H(function(){R(0,null,{method:"readString",params:[file,af],event:P(aa)});})},"readBase64":function(file,aa){H(function(){R(0,null,{method:"readBase64",params:[file],event:P(aa)});})},"readHTML":function(file,defencode,aa){H(function(){R(0,null,{method:"readHTML",params:[file,defencode],event:P(aa)});})},"chooseFile":function(ext,defext,saveselect,aa){H(function(){R(1,null,{method:"chooseFile",params:[ext,defext,saveselect],event:P(aa)});})},"showPageSetupDialog":function(aa){var ao=function(result){aa(result?eval("("+result+")"):null);};H(function(){R(0,null,{method:"showPageSetupDialog",event:P(ao)});})},"getLastSettings":function(settingid,aa){H(function(){R(0,null,{method:"getLastSettings",params:[settingid],event:P(aa)});})},"getAbsoluteURL":function(relative,base,aa){var stack=base.split("/"),parts=relative.split("/");stack.pop();for(var i=0;i<parts.length;i++){if(parts[i]==".")continue;if(parts[i]=="..")stack.pop();else stack.push(parts[i]);}(aa||this.nothing).call(this,stack.join("/"));},"setLastSettings":function(settingid,ad,aa){H(function(){R(0,null,{method:"setLastSettings",params:[settingid,ad],event:P(aa)});})},"setDefaultPrinter":function(printer,aa){H(function(){R(0,null,{method:"setDefaultPrinter",params:[printer],event:P(aa)});})},"openFile":function(file,aa){H(function(){R(1,null,{method:"openFile",params:[file],event:P(aa)});})},"getPrinterInfo":function(printer,aa){H(function(){R(0,null,{method:"getPrinterInfo",params:[printer],event:P(aa)});})},"getPrinterStatus":function(printer,Z,aa){H(function(){R(0,null,{method:"getPrinterStatus",params:[printer,Z],event:P(aa)});})},"nothing":function(){},"setPrintBackground":function(back,aa){H(function(){R(0,null,{method:"setPrintBackground",params:[back],event:P(aa)});})},"getServerId":function(url,aa){ajax(aj[3],{method:"getServerId",url:url},function(data){aa(data.result);});}})).initialize();};var an={};function getJCP(as){as=as||"127.0.0.1";if(!an[as]){an[as]=new k(as);}return an[as];};function J(){var g=false,h=null,c=["MSIE","Firefox","Chrome"];for(var e=0;e<c.length;e++){if(navigator.userAgent.indexOf(c[e])>-1){g=true;break}}if(!g){h="杰表打印控件不支持本浏览器!"}else{if(navigator.userAgent.indexOf("Chrome")>-1){var b=navigator.plugins,d=false;for(var j=0;j<b.length;j++){if(b[j].name.indexOf("jatoolsPrinter")==0){d=true;break}}if(!d){h="杰表打印控件未安装，请点击<a href='jatoolsPrinter.crx'>此处</a>安装."}}}if(h){T(h)}};function T(d){var c=document.getElementsByTagName("input");for(var b=0;b<c.length;b++){c[b].disabled=true}var a=document.getElementById("errs");a.innerHTML=d;a.style.display="block"};function U(){var a=document.URL.replace(/^http[s]?\:\/\/.*?\//i,"");window.showModalDialog("/sourceviewer/view.jsp?from="+escape(a),null,"dialogWidth=1024px;dialogHeight=670px;status=no;help=no;scroll=no;resizable=yes")};function L(){getJP().exit()};var JSON=JSON||{};var JSONstringify=JSON.stringify||function(obj){var t=typeof(obj);if(t!="object"||obj===null){if(t=="string")obj='"'+obj+'"';return String(obj);}else{var n,v,json=[],Y=(obj&&obj.constructor==Array);for(n in obj){v=obj[n];t=typeof(v);if(t=="string")v='"'+v+'"';else if(t=="object"&&v!==null)v=JSONstringify(v);json.push((Y?"":'"'+n+'":')+String(v));}return(Y?"[":"{")+String(json)+(Y?"]":"}");}}; 